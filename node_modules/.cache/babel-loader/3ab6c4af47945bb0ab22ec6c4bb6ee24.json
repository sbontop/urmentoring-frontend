{"ast":null,"code":"import \"antd/es/table/style\";\nimport _Table from \"antd/es/table\";\nimport \"antd/es/popconfirm/style\";\nimport _Popconfirm from \"antd/es/popconfirm\";\nimport \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/divider/style\";\nimport _Divider from \"antd/es/divider\";\nimport \"antd/es/rate/style\";\nimport _Rate from \"antd/es/rate\";\nimport \"antd/es/menu/style\";\nimport _Menu from \"antd/es/menu\";\nimport \"antd/es/form/style\";\nimport _Form from \"antd/es/form\";\nvar _jsxFileName = \"C:\\\\Users\\\\Home\\\\Desktop\\\\app-urmentoring-view\\\\src\\\\components\\\\Usuario\\\\WrappedEditableTable.js\";\nimport React from 'react';\nimport MetodosAxios from '../../requerimientos/MetodosAxios';\nconst FormItem = _Form.Item;\nconst SubMenu = _Menu.SubMenu;\n\nfunction handleMenuClick(e) {\n  console.log('click', e);\n}\n\nconst menu = React.createElement(_Menu, {\n  onClick: handleMenuClick,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 27\n  },\n  __self: this\n}, React.createElement(_Menu.Item, {\n  key: \"1\",\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 28\n  },\n  __self: this\n}, \"Editar\"), React.createElement(_Menu.Item, {\n  key: \"2\",\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 29\n  },\n  __self: this\n}, \"Eliminar\"));\n\nclass EditableTable extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.handleChangeRating = rating => {\n      this.setState({\n        rating: rating\n      }, () => {\n        console.log('this.state.rating', this.state.rating);\n      });\n    };\n\n    this.obtener_libros = () => {\n      let libros = [];\n      MetodosAxios.obtener_libros().then(res => {\n        console.log(res);\n        res.data.map(registro => {\n          let libro = {\n            key: registro.isbn,\n            titulo: registro.titulo,\n            isbn: registro.isbn,\n            rating: 5\n          };\n          libros.push(libro);\n        });\n        console.log('libros', libros);\n        this.setState({\n          libros: res.data\n        }, () => {\n          console.log('this.state.libros', this.state.libros);\n          this.obtener_libroautores(parseInt(this.props.autor_seleccionado.id));\n        });\n      });\n    };\n\n    this.obtener_libroautores = id_autor_seleccionado => {\n      let libroautores = [];\n      MetodosAxios.obtener_libroautores().then(libros_del_autor => {\n        console.log('libros_del_autor', libros_del_autor);\n        libros_del_autor.data.map(libroautor => {\n          let id_autor = libroautor.id;\n          console.log('id_autor_seleccionado, id_autor', id_autor_seleccionado, id_autor);\n\n          if (id_autor_seleccionado === id_autor) {\n            console.log('autores iguales');\n            libroautor.key = libroautor.id;\n            libroautor.isEditing = false;\n            MetodosAxios.obtener_libros().then(libros => {\n              libros.data.map(libro => {\n                console.log('libroautor.isbn, libro.isbn', libroautor.isbn, libro.isbn);\n                let isbn_libro = libro.isbn;\n\n                if (libroautor.isbn === libro.isbn) {\n                  console.log('libros iguales');\n                  libro.key = libro.id;\n                  libro.isEditing = false;\n                  libroautores.push(libro);\n                }\n              });\n            });\n          }\n        });\n      });\n      this.setState({\n        data: libroautores,\n        loading: false\n      }, () => {\n        console.log('this.state.data', this.state.data);\n      });\n    };\n\n    this.generar_libros = () => {\n      let libros = [];\n      let cont = 0;\n      let id_autor = 0;\n\n      for (let i = 0; i < 100; i++) {\n        cont += 1;\n\n        if (cont == 20) {\n          cont = 0;\n          id_autor += 1;\n        }\n\n        let libro = {\n          id: i,\n          // el campo key sirve para que sea unico en la tabla        \n          key: i,\n          id_autor: id_autor,\n          titulo: \"Libro \".concat(i),\n          isbn: \"1111111111\",\n          rating: 5\n        };\n        libros.push(libro);\n      }\n\n      this.setState({\n        libros: libros\n      }, () => {\n        console.log('this.state.libros', this.state.libros);\n        this.obtener_libros_del_autor(parseInt(this.props.autor_seleccionado.id));\n      });\n    };\n\n    this.obtener_libros_del_autor = id_autor_seleccionado => {\n      let libros_del_autor = [];\n      this.state.libros.map(libro => {\n        if (libro.id_autor === id_autor_seleccionado) {\n          libro.isEditing = false;\n          libros_del_autor.push(libro);\n        }\n      });\n      this.setState({\n        data: libros_del_autor,\n        loading: false\n      }, () => {\n        console.log('this.state.data', this.state.data);\n      });\n    };\n\n    this.componentDidMount = () => {\n      // this.generar_libros();\n      this.obtener_libros();\n      this.obtener_libroautores();\n    };\n\n    this.isEditing = record => {\n      return record.key === this.state.editingKey;\n    };\n\n    this.handleSubmit = e => {\n      e.preventDefault();\n      this.props.form.validateFields((err, row) => {\n        if (err) return;\n        console.log('row', row);\n        let item = undefined;\n        this.state.data.map(registro => {\n          if (registro.key === this.state.editingKey) {\n            item = registro;\n          }\n        });\n        console.log('item', item);\n        let rows = this.state.data;\n        rows.map(obj => {\n          console.log('obj.key, item.key', obj.key, item.key);\n\n          if (obj.key === item.key) {\n            /**\r\n             * Edito unicamente el rating \r\n             */\n            obj.rating = row.rating;\n            console.log('ENVIO FORMULARIO', obj);\n            this.setState({\n              data: rows\n            }, () => {\n              console.log('this.state.data', this.state.data);\n            });\n          }\n        });\n      }); // INICIO cerrar la edicion\n\n      let rows = [];\n      this.state.data.map(obj => {\n        obj.isEditing = false;\n        rows.push(obj);\n      });\n      this.setState({\n        editingKey: \"\",\n        data: rows\n      }); // FIN cerrar la edicion\n    };\n\n    this.cancel = () => {\n      let rows = [];\n      this.state.data.map(obj => {\n        obj.isEditing = false;\n        rows.push(obj);\n      });\n      this.setState({\n        editingKey: \"\",\n        data: rows\n      });\n    };\n\n    this.state = {\n      data: [],\n      libros: [],\n      libroautores: [],\n      calificaciones: [],\n      editingKey: \"\",\n      loading: true,\n      rating: -1\n    };\n    this.handleChangeRating = this.handleChangeRating.bind(this);\n  }\n\n  delete(key) {\n    let rows = this.state.data; // console.log('rows', rows);\n\n    console.log('this.state.data', this.state.data);\n\n    for (let i = 0; i < rows.length; i++) {\n      if (rows[i].key === key) rows.splice(i, 1);\n    } // console.log('rows', rows);\n\n\n    this.setState({\n      data: rows\n    }, () => {\n      console.log('this.state.data', this.state.data);\n    });\n  }\n\n  edit(key) {\n    let rows = [];\n    this.state.data.map(obj => {\n      if (obj.key === key) obj.isEditing = true;else obj.isEditing = false;\n      rows.push(obj);\n    });\n    this.setState({\n      editingKey: key,\n      data: rows\n    });\n  }\n\n  render() {\n    const getFieldDecorator = this.props.form.getFieldDecorator;\n    return React.createElement(_Form, {\n      onSubmit: this.handleSubmit,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 255\n      },\n      __self: this\n    }, React.createElement(_Table, {\n      dataSource: this.state.data,\n      columns: [{\n        title: 'Titulo',\n        dataIndex: 'titulo',\n        editable: false,\n        render: (text, record) => {\n          return React.createElement(\"span\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 264\n            },\n            __self: this\n          }, text);\n        }\n      }, {\n        title: 'ISBN',\n        dataIndex: 'isbn',\n        key: 'isbn',\n        editable: false,\n        render: (text, record) => {\n          return React.createElement(\"span\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 273\n            },\n            __self: this\n          }, text);\n        }\n      }, {\n        title: 'Rating',\n        key: 'rating',\n        dataIndex: 'rating',\n        editable: false,\n        render: (text, record) => {\n          if (record.isEditing) {\n            return React.createElement(FormItem, {\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 283\n              },\n              __self: this\n            }, getFieldDecorator('rating', {\n              rules: [{\n                required: true,\n                message: \"Por favor ingrese el rating!\"\n              }],\n              initialValue: record.rating\n            })(React.createElement(_Rate, {\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 293\n              },\n              __self: this\n            })));\n          } else return React.createElement(_Rate, {\n            disabled: true,\n            defaultValue: record.rating,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 297\n            },\n            __self: this\n          });\n        }\n      }, {\n        title: 'Action',\n        key: 'action',\n        render: (text, record) => {\n          return React.createElement(\"div\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 305\n            },\n            __self: this\n          }, record.isEditing == false && React.createElement(\"span\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 308\n            },\n            __self: this\n          }, React.createElement(\"a\", {\n            onClick: () => this.edit(record.key),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 309\n            },\n            __self: this\n          }, \"Editar\"), React.createElement(_Divider, {\n            type: \"vertical\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 310\n            },\n            __self: this\n          }), React.createElement(\"a\", {\n            onClick: () => this.delete(record.key),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 311\n            },\n            __self: this\n          }, \"Eliminar\")), record.isEditing && React.createElement(\"span\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 316\n            },\n            __self: this\n          }, React.createElement(_Button, {\n            htmlType: \"submit\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 317\n            },\n            __self: this\n          }, \"Aceptar\"), React.createElement(_Divider, {\n            type: \"vertical\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 321\n            },\n            __self: this\n          }), React.createElement(_Popconfirm, {\n            title: \"\\xBFSeguro de Cancelar?\",\n            onConfirm: () => this.cancel(record.key),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 322\n            },\n            __self: this\n          }, React.createElement(\"a\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 323\n            },\n            __self: this\n          }, \"Cancelar\"))));\n        }\n      }],\n      bordered: true,\n      loading: this.state.loading,\n      rowClassName: \"editable-row\",\n      title: () => \"Autor:  \".concat(this.props.autor_seleccionado.nombres),\n      footer: () => \"N\\xFAmero de libros encontrados: \".concat(this.state.data.length) // showHeader\n      ,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 256\n      },\n      __self: this\n    }));\n  }\n\n}\n\nconst WrappedEditableTable = _Form.create({})(EditableTable);\n\nexport default WrappedEditableTable;","map":{"version":3,"sources":["C:\\Users\\Home\\Desktop\\app-urmentoring-view\\src\\components\\Usuario\\WrappedEditableTable.js"],"names":["React","MetodosAxios","FormItem","Item","SubMenu","handleMenuClick","e","console","log","menu","EditableTable","Component","constructor","props","handleChangeRating","rating","setState","state","obtener_libros","libros","then","res","data","map","registro","libro","key","isbn","titulo","push","obtener_libroautores","parseInt","autor_seleccionado","id","id_autor_seleccionado","libroautores","libros_del_autor","libroautor","id_autor","isEditing","isbn_libro","loading","generar_libros","cont","i","obtener_libros_del_autor","componentDidMount","record","editingKey","handleSubmit","preventDefault","form","validateFields","err","row","item","undefined","rows","obj","cancel","calificaciones","bind","delete","length","splice","edit","render","getFieldDecorator","title","dataIndex","editable","text","rules","required","message","initialValue","nombres","WrappedEditableTable","create"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport {\r\n  Table,\r\n  Form,\r\n  Input,\r\n  InputNumber,\r\n  DatePicker,\r\n  Button,\r\n  message,\r\n  Rate,\r\n  Dropdown,\r\n  Menu,\r\n  Icon,\r\n  Popconfirm,\r\n  Divider,\r\n} from \"antd\";\r\nimport MetodosAxios from '../../requerimientos/MetodosAxios';\r\n\r\nconst FormItem = Form.Item;\r\nconst { SubMenu } = Menu;\r\n\r\nfunction handleMenuClick(e) {\r\n  console.log('click', e);\r\n}\r\n\r\nconst menu = (\r\n  <Menu onClick={handleMenuClick}>\r\n    <Menu.Item key=\"1\">Editar</Menu.Item>\r\n    <Menu.Item key=\"2\">Eliminar</Menu.Item>\r\n  </Menu>\r\n);\r\n\r\nclass EditableTable extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      data: [],\r\n      libros: [],\r\n      libroautores: [],\r\n      calificaciones: [],\r\n      editingKey: \"\",\r\n      loading: true,\r\n      rating: -1,\r\n    }\r\n    this.handleChangeRating = this.handleChangeRating.bind(this);\r\n  }\r\n\r\n  handleChangeRating = rating => {\r\n    this.setState({\r\n      rating: rating,\r\n    }, () => {\r\n      console.log('this.state.rating', this.state.rating);\r\n    });\r\n  }\r\n\r\n  obtener_libros = () => {\r\n    let libros = [];\r\n    MetodosAxios.obtener_libros().then(res => {\r\n      console.log(res)\r\n      res.data.map(registro => {\r\n        let libro = {\r\n          key: registro.isbn,\r\n          titulo: registro.titulo,\r\n          isbn: registro.isbn,\r\n          rating: 5\r\n        }\r\n        libros.push(libro);\r\n      });\r\n      console.log('libros', libros);\r\n      this.setState({\r\n        libros: res.data,\r\n      }, () => {\r\n        console.log('this.state.libros', this.state.libros);\r\n        this.obtener_libroautores(parseInt(this.props.autor_seleccionado.id));\r\n      });\r\n    });\r\n  }\r\n\r\n  obtener_libroautores = (id_autor_seleccionado) => {\r\n    let libroautores = [];\r\n    MetodosAxios.obtener_libroautores().then(libros_del_autor => {\r\n      console.log('libros_del_autor', libros_del_autor);\r\n      libros_del_autor.data.map(libroautor => {\r\n        let id_autor = libroautor.id;\r\n        console.log('id_autor_seleccionado, id_autor', id_autor_seleccionado, id_autor);\r\n        if (id_autor_seleccionado === id_autor) {\r\n          console.log('autores iguales');\r\n          libroautor.key = libroautor.id;\r\n          libroautor.isEditing = false;\r\n          MetodosAxios.obtener_libros().then(libros => {\r\n            libros.data.map(libro => {\r\n              console.log('libroautor.isbn, libro.isbn', libroautor.isbn, libro.isbn);\r\n              let isbn_libro = libro.isbn;\r\n              if (libroautor.isbn === libro.isbn) {\r\n                console.log('libros iguales');\r\n                libro.key = libro.id;\r\n                libro.isEditing = false;\r\n                libroautores.push(libro);\r\n              }\r\n            });\r\n          });\r\n        }\r\n      });      \r\n    });\r\n    this.setState({\r\n      data: libroautores,\r\n      loading: false,\r\n    }, () => {\r\n      console.log('this.state.data', this.state.data);\r\n    });\r\n  }\r\n\r\n  generar_libros = () => {\r\n    let libros = [];\r\n    let cont = 0;\r\n    let id_autor = 0;\r\n    for (let i = 0; i < 100; i++) {\r\n      cont += 1;\r\n\r\n      if (cont == 20) {\r\n        cont = 0;\r\n        id_autor += 1;\r\n      }\r\n      let libro = {\r\n        id: i,\r\n        // el campo key sirve para que sea unico en la tabla        \r\n        key: i,\r\n        id_autor: id_autor,\r\n        titulo: `Libro ${i}`,\r\n        isbn: `1111111111`,\r\n        rating: 5,\r\n      };\r\n      libros.push(libro);\r\n    }\r\n    this.setState({\r\n      libros: libros,\r\n    }, () => {\r\n      console.log('this.state.libros', this.state.libros);\r\n      this.obtener_libros_del_autor(parseInt(this.props.autor_seleccionado.id));\r\n    });\r\n  }\r\n\r\n  obtener_libros_del_autor = (id_autor_seleccionado) => {\r\n    let libros_del_autor = [];\r\n    this.state.libros.map(libro => {\r\n      if (libro.id_autor === id_autor_seleccionado) {\r\n        libro.isEditing = false;\r\n        libros_del_autor.push(libro);\r\n      }\r\n    });\r\n    this.setState({\r\n      data: libros_del_autor,\r\n      loading: false,\r\n    }, () => {\r\n      console.log('this.state.data', this.state.data);\r\n    })\r\n  }\r\n\r\n  componentDidMount = () => {\r\n    // this.generar_libros();\r\n    this.obtener_libros();\r\n    this.obtener_libroautores();\r\n  }\r\n\r\n  isEditing = record => {\r\n    return record.key === this.state.editingKey;\r\n  };\r\n\r\n  delete(key) {\r\n    let rows = this.state.data;\r\n    // console.log('rows', rows);\r\n    console.log('this.state.data', this.state.data);\r\n    for (let i = 0; i < rows.length; i++) {\r\n      if (rows[i].key === key)\r\n        rows.splice(i, 1)\r\n    }\r\n    // console.log('rows', rows);\r\n    this.setState({\r\n      data: rows,\r\n    }, () => {\r\n      console.log('this.state.data', this.state.data);\r\n    })\r\n  }\r\n\r\n  edit(key) {\r\n    let rows = [];\r\n    this.state.data.map(obj => {\r\n      if (obj.key === key)\r\n        obj.isEditing = true\r\n      else\r\n        obj.isEditing = false\r\n      rows.push(obj)\r\n    })\r\n    this.setState({ editingKey: key, data: rows });\r\n  }\r\n\r\n\r\n  handleSubmit = e => {\r\n    e.preventDefault();\r\n    this.props.form.validateFields((err, row) => {\r\n      if (err)\r\n        return\r\n      console.log('row', row);\r\n\r\n      let item = undefined;\r\n      this.state.data.map(registro => {\r\n        if (registro.key === this.state.editingKey) {\r\n          item = registro;\r\n        }\r\n      });\r\n      console.log('item', item);\r\n\r\n      let rows = this.state.data;\r\n      rows.map(obj => {\r\n        console.log('obj.key, item.key', obj.key, item.key);\r\n        if (obj.key === item.key) {\r\n          /**\r\n           * Edito unicamente el rating \r\n           */\r\n          obj.rating = row.rating;\r\n          console.log('ENVIO FORMULARIO', obj);\r\n          this.setState({\r\n            data: rows,\r\n          }, () => {\r\n            console.log('this.state.data', this.state.data);\r\n          });\r\n        }\r\n      });\r\n\r\n\r\n    })\r\n\r\n    // INICIO cerrar la edicion\r\n    let rows = [];\r\n    this.state.data.map(obj => {\r\n      obj.isEditing = false\r\n      rows.push(obj)\r\n    })\r\n    this.setState({ editingKey: \"\", data: rows });\r\n    // FIN cerrar la edicion\r\n  }\r\n\r\n  cancel = () => {\r\n    let rows = [];\r\n    this.state.data.map(obj => {\r\n      obj.isEditing = false\r\n      rows.push(obj)\r\n    })\r\n    this.setState({ editingKey: \"\", data: rows });\r\n  };\r\n\r\n  render() {\r\n    const { getFieldDecorator } = this.props.form;\r\n    return (\r\n      <Form onSubmit={this.handleSubmit}>\r\n        <Table\r\n          dataSource={this.state.data}\r\n          columns={[\r\n            {\r\n              title: 'Titulo',\r\n              dataIndex: 'titulo',\r\n              editable: false,\r\n              render: (text, record) => {\r\n                return <span>{text}</span>\r\n              }\r\n            },\r\n            {\r\n              title: 'ISBN',\r\n              dataIndex: 'isbn',\r\n              key: 'isbn',\r\n              editable: false,\r\n              render: (text, record) => {\r\n                return <span>{text}</span>\r\n              }\r\n            },\r\n            {\r\n              title: 'Rating',\r\n              key: 'rating',\r\n              dataIndex: 'rating',\r\n              editable: false,\r\n              render: (text, record) => {\r\n                if (record.isEditing) {\r\n                  return <FormItem>\r\n                    {getFieldDecorator('rating', {\r\n                      rules: [\r\n                        {\r\n                          required: true,\r\n                          message: `Por favor ingrese el rating!`\r\n                        }\r\n                      ],\r\n                      initialValue: record.rating\r\n                    })(\r\n                      <Rate />\r\n                    )}\r\n                  </FormItem>\r\n                } else\r\n                  return <Rate disabled defaultValue={record.rating} />\r\n              }\r\n            },\r\n            {\r\n              title: 'Action',\r\n              key: 'action',\r\n              render: (text, record) => {\r\n                return (\r\n                  <div>\r\n                    {\r\n                      record.isEditing == false &&\r\n                      <span>\r\n                        <a onClick={() => this.edit(record.key)}>Editar</a>\r\n                        <Divider type=\"vertical\" />\r\n                        <a onClick={() => this.delete(record.key)}>Eliminar</a>\r\n                      </span>\r\n                    }\r\n                    {\r\n                      record.isEditing &&\r\n                      <span>\r\n                        <Button htmlType=\"submit\">Aceptar</Button>\r\n                        {/*<Popconfirm title=\"¿Seguro de Aceptar?\" onConfirm={() => this.handleSubmit(record)}>\r\n                          <a>Aceptar</a>\r\n                        </Popconfirm>*/}\r\n                        <Divider type=\"vertical\" />\r\n                        <Popconfirm title=\"¿Seguro de Cancelar?\" onConfirm={() => this.cancel(record.key)}>\r\n                          <a>Cancelar</a>\r\n                        </Popconfirm>\r\n                      </span>\r\n                    }\r\n                  </div>\r\n                )\r\n              }\r\n            },\r\n          ]}\r\n          bordered\r\n          loading={this.state.loading}\r\n          rowClassName=\"editable-row\"\r\n          title={() => `Autor:  ${this.props.autor_seleccionado.nombres}`}\r\n          footer={() => `Número de libros encontrados: ${this.state.data.length}`}\r\n        // showHeader\r\n        />\r\n      </Form>\r\n    )\r\n  }\r\n}\r\n\r\nconst WrappedEditableTable = Form.create({})(EditableTable);\r\nexport default WrappedEditableTable;"]},"metadata":{},"sourceType":"module"}